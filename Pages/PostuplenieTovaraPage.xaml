<Page x:Class="Kursovoi.Pages.PostuplenieTovaraPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Kursovoi.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1200"
      Title="Поступление товара" Loaded="Page_Loaded">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="4*" MinWidth="350"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="6*" MinWidth="600"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель - Список поступлений -->
        <Border Grid.Column="0" Background="White" BorderBrush="#FFE0E0E0" BorderThickness="0,0,1,0">
            <DockPanel>
                <!-- Панель инструментов -->
                <ToolBar DockPanel.Dock="Top" Background="#FF2C3E50">
                    <Button x:Name="AddButton" Content="+ Новое" Click="AddButton_Click"
                            ToolTip="Создать новое поступление" Height="30" Width="85" Margin="2" Foreground="White"/>
                    <Button x:Name="EditButton" Content="✏ Изменить" Click="EditButton_Click"
                            ToolTip="Редактировать выбранное поступление" Height="30" Width="95" Margin="2" Foreground="White"/>
                    <Button x:Name="DeleteButton" Content="🗑 Удалить" Click="DeleteButton_Click"
                            ToolTip="Удалить выбранное поступление" Height="30" Width="95" Margin="2" Foreground="White"/>
                    <Separator/>
                    <TextBlock Text="Поиск:" VerticalAlignment="Center" Margin="5,0" Foreground="White"/>
                    <TextBox x:Name="SearchBox" Width="150" Height="25" 
                             TextChanged="SearchBox_TextChanged" VerticalContentAlignment="Center"/>
                </ToolBar>

                <!-- Список поступлений -->
                <DataGrid x:Name="PostuplenieGrid" 
                          SelectionChanged="PostuplenieGrid_SelectionChanged"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          RowDetailsVisibilityMode="Collapsed"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="False"
                          CanUserResizeRows="False"
                          CanUserSortColumns="True"
                          Margin="0" Background="#FF2C3E50">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="№" Binding="{Binding Id_PostuplenieTovara}" 
                                          Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Дата" Binding="{Binding DataPostupleniya, StringFormat=dd.MM.yyyy}" 
                                          Width="80"/>
                        <DataGridTextColumn Header="Поставщик" 
                                          Binding="{Binding CompanyPostavshiki.NamePostavshiki}"
                                          Width="*" MinWidth="150"/>
                        <DataGridTextColumn Header="Договор" Binding="{Binding Dogovor}" 
                                          Width="100"/>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Height" Value="30"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#FF2ECC71"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </DockPanel>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1" Width="5" Background="#FFE0E0E0" 
                      HorizontalAlignment="Center" VerticalAlignment="Stretch"
                      ResizeBehavior="PreviousAndNext"
                      ShowsPreview="True"/>

        <!-- Правая панель - Форма редактирования -->
        <Border Grid.Column="2" Background="White">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Background="#FF2C3E50">
                <StackPanel Margin="20" x:Name="FormPanel">
                    <!-- Заголовок формы -->
                    <!-- В заголовке формы (замените существующий Border) -->
                    <Border Background="#FF2C3E50" CornerRadius="3" Padding="10" Margin="0,0,0,15">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Button x:Name="BackButton" Content="← Назад" 
                                    Width="80" Height="25" Margin="0,0,15,0"
                                    Background="#FF3498DB" Foreground="White"
                                    FontWeight="Bold" Click="BackButton_Click"/>
                            <TextBlock x:Name="FormTitle" Text="НОВЫЙ ЗАКАЗ" 
                                    FontSize="16" FontWeight="Bold" Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- Основные поля шапки -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Номер поступления -->
                        <Label Grid.Row="0" Grid.Column="0" Content="Номер:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <TextBox Grid.Row="0" Grid.Column="1" x:Name="NumberBox" 
                                 IsReadOnly="True" Height="25" Margin="0,5,0,5"
                                 Background="#FFF9F9F9" Foreground="Gray"/>

                        <!-- Дата поступления -->
                        <Label Grid.Row="1" Grid.Column="0" Content="Дата:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <DatePicker Grid.Row="1" Grid.Column="1" x:Name="DatePicker" 
                                    Height="25" Margin="0,5,0,5"/>

                        <!-- Поставщик -->
                        <Label Grid.Row="2" Grid.Column="0" Content="Поставщик:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <ComboBox Grid.Row="2" Grid.Column="1" x:Name="SupplierComboBox" 
                                  Height="25" Margin="0,5,0,5"
                                  DisplayMemberPath="NamePostavshiki"
                                  SelectedValuePath="Id_Postavshiki"/>

                        <!-- Договор -->
                        <Label Grid.Row="3" Grid.Column="0" Content="Договор:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <TextBox Grid.Row="3" Grid.Column="1" x:Name="ContractBox" 
                                 Height="25" Margin="0,5,0,5"/>
                    </Grid>

                    <!-- Табличная часть - Товары -->
                    <Border  BorderThickness="1" CornerRadius="3" 
                            Margin="0,20,0,0" Padding="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Заголовок таблицы -->
                            <Border Grid.Row="0" Background="#FF2C3E50" 
                                    BorderThickness="0,0,0,1" Padding="10,5">
                                <TextBlock Text="ТОВАРЫ" FontWeight="Bold" Foreground="White"/>
                            </Border>

                            <!-- Таблица товаров -->
                            <DataGrid Grid.Row="1" x:Name="ItemsGrid"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="True"
                                      CanUserDeleteRows="True"
                                      HeadersVisibility="Column"
                                      SelectionMode="Single"
                                      SelectionUnit="FullRow"
                                      Margin="0"
                                      AddingNewItem="ItemsGrid_AddingNewItem"
                                      CellEditEnding="ItemsGrid_CellEditEnding">
                                <DataGrid.Columns>
                                    <DataGridComboBoxColumn Header="Товар" 
                                        Width="*" MinWidth="200" x:Name="ItemColumn">
                                        <DataGridComboBoxColumn.ElementStyle>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="ItemsSource" Value="{Binding DataContext.ItemColumn.ItemsSource, RelativeSource={RelativeSource AncestorType=Page}}"/>
                                                <Setter Property="DisplayMemberPath" Value="Name_MaterialyIFurnitura"/>
                                                <Setter Property="SelectedValuePath" Value="Id_MaterialyIFurnitura"/>
                                                <Setter Property="SelectedValue" Value="{Binding Id_Materiala, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                            </Style>
                                        </DataGridComboBoxColumn.ElementStyle>
                                        <DataGridComboBoxColumn.EditingElementStyle>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="ItemsSource" Value="{Binding DataContext.ItemColumn.ItemsSource, RelativeSource={RelativeSource AncestorType=Page}}"/>
                                                <Setter Property="DisplayMemberPath" Value="Name_MaterialyIFurnitura"/>
                                                <Setter Property="SelectedValuePath" Value="Id_MaterialyIFurnitura"/>
                                                <Setter Property="SelectedValue" Value="{Binding Id_Materiala, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                            </Style>
                                        </DataGridComboBoxColumn.EditingElementStyle>
                                    </DataGridComboBoxColumn>

                                    <DataGridTextColumn Header="Кол-во" 
                                                        Binding="{Binding Kolichestvo_Postuplenie, Mode=TwoWay}"
                                                        Width="80"/>

                                    <DataGridTextColumn Header="Цена" 
                                                        Binding="{Binding Cena, Mode=TwoWay, StringFormat=N2}"
                                                        Width="80"/>

                                    <DataGridTextColumn Header="Сумма" 
                                                        Binding="{Binding Summa, Mode=TwoWay, StringFormat=N2}"
                                                        Width="90" IsReadOnly="True"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- Итого -->
                            <Border Grid.Row="2" Background="#FF2C3E50"  
                                    BorderThickness="0,1,0,0" Padding="10,5">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <TextBlock Text="ИТОГО:" FontWeight="Bold" Margin="0,0,10,0" Foreground="White"/>
                                    <TextBlock x:Name="TotalText" Text="0.00" FontWeight="Bold" 
                                               Foreground="White" MinWidth="100"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Сообщения об ошибках -->
                    <Border x:Name="ErrorBorder" Background="#FFFDE8E8" BorderBrush="#FFE74C3C" 
                            BorderThickness="1" CornerRadius="3" Padding="10" Margin="0,20,0,0"
                            Visibility="Collapsed">
                        <TextBlock x:Name="ErrorText" Foreground="#FFC0392B" TextWrapping="Wrap"/>
                    </Border>

                    <!-- Кнопки формы -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,30,0,0">
                        <Button x:Name="SaveButton" Content="Сохранить" 
                                Width="120" Height="35" Margin="5,0" 
                                Background="#FF27AE60" Foreground="White"
                                FontWeight="Bold" Click="SaveButton_Click"/>
                        <Button x:Name="CancelButton" Content="Отмена" 
                                Width="120" Height="35" Margin="5,0" 
                                Background="#FFE74C3C" Foreground="White"
                                FontWeight="Bold" Click="CancelButton_Click"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Page>
