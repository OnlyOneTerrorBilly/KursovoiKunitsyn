<Page x:Class="Kursovoi.Pages.SpisokZakazovPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Kursovoi.Pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1200"
      Title="Список заказов" Loaded="Page_Loaded">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="4*" MinWidth="350"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="6*" MinWidth="600"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель - Список заказов -->
        <Border Grid.Column="0" Background="White" BorderBrush="#FFE0E0E0" BorderThickness="0,0,1,0">
            <DockPanel>
                <!-- Панель инструментов -->
                <ToolBar DockPanel.Dock="Top" Background="#FF2C3E50">
                    <Button x:Name="AddButton" Content="+ Новый" Click="AddButton_Click"
                            ToolTip="Создать новый заказ" Height="30" Width="80" Margin="2" Foreground="White"/>
                    <Button x:Name="EditButton" Content="✏ Изменить" Click="EditButton_Click"
                            ToolTip="Редактировать выбранный заказ" Height="30" Width="90" Margin="2" Foreground="White"/>
                    <Button x:Name="DeleteButton" Content="🗑 Удалить" Click="DeleteButton_Click"
                            ToolTip="Удалить выбранный заказ" Height="30" Width="90" Margin="2" Foreground="White"/>
                    <Separator/>
                    <TextBlock Text="Поиск:" VerticalAlignment="Center" Margin="5,0" Foreground="White"/>
                    <TextBox x:Name="SearchBox" Width="150" Height="25" 
                             TextChanged="SearchBox_TextChanged" VerticalContentAlignment="Center"/>
                </ToolBar>

                <!-- Список заказов -->
                <DataGrid x:Name="ZakazyGrid" 
                          SelectionChanged="ZakazyGrid_SelectionChanged"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          RowDetailsVisibilityMode="Collapsed"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="False"
                          CanUserResizeRows="False"
                          CanUserSortColumns="True"
                          Margin="0" Background="#FF2C3E50">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="№" Binding="{Binding Id_SpiskaZakazov}" 
                                          Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Дата" Binding="{Binding DataZakaza, StringFormat=dd.MM.yyyy}" 
                                          Width="80"/>
                        <DataGridTextColumn Header="Номер заказа" Binding="{Binding NomerZakaza}" 
                                          Width="80"/>
                        <DataGridTextColumn Header="Статус" 
                                          Binding="{Binding StatusyZakazov.NameStatusyZakazov}"
                                          Width="*" MinWidth="120"/>
                        <DataGridTextColumn Header="Клиент" 
                                          Binding="{Binding Zakazchiki.FullName}"
                                          Width="120"/>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Height" Value="30"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#FF3498DB"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </DockPanel>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1" Width="5" Background="#FFE0E0E0" 
                      HorizontalAlignment="Center" VerticalAlignment="Stretch"
                      ResizeBehavior="PreviousAndNext"
                      ShowsPreview="True"/>

        <!-- Правая панель - Форма редактирования -->
        <Border Grid.Column="2" Background="White">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Background="#FF2C3E50">
                <StackPanel Margin="20" x:Name="FormPanel">
                    <!-- Заголовок формы -->
                    <Border Background="#FF2C3E50" CornerRadius="3" Padding="10" Margin="0,0,0,15">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Button x:Name="BackButton" Content="← Назад" 
                                    Width="80" Height="25" Margin="0,0,15,0"
                                    Background="#FF3498DB" Foreground="White"
                                    FontWeight="Bold" Click="BackButton_Click"/>
                            <TextBlock x:Name="FormTitle" Text="НОВЫЙ ЗАКАЗ" 
                                       FontSize="16" FontWeight="Bold" Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- Основные поля -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Номер записи -->
                        <Label Grid.Row="0" Grid.Column="0" Content="ID:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <TextBox Grid.Row="0" Grid.Column="1" x:Name="IdBox" 
                                 IsReadOnly="True" Height="25" Margin="0,5,0,5"
                                 Background="#FFF9F9F9" Foreground="Gray"/>

                        <!-- Дата заказа -->
                        <Label Grid.Row="1" Grid.Column="0" Content="Дата:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <DatePicker Grid.Row="1" Grid.Column="1" x:Name="DatePicker" 
                                    Height="25" Margin="0,5,0,5"/>

                        <!-- Номер заказа -->
                        <Label Grid.Row="2" Grid.Column="0" Content="Номер заказа:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <TextBox Grid.Row="2" Grid.Column="1" x:Name="OrderNumberBox" 
                                 Height="25" Margin="0,5,0,5"/>

                        <!-- Статус -->
                        <Label Grid.Row="3" Grid.Column="0" Content="Статус:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <ComboBox Grid.Row="3" Grid.Column="1" x:Name="StatusComboBox" 
                                  Height="25" Margin="0,5,0,5"
                                  DisplayMemberPath="NameStatusyZakazov"
                                  SelectedValuePath="Id_StatusyZakazov"/>

                        <!-- Заказчик -->
                        <Label Grid.Row="4" Grid.Column="0" Content="Заказчик:" 
                               HorizontalAlignment="Right" Margin="0,5,10,5" Foreground="White"/>
                        <ComboBox Grid.Row="4" Grid.Column="1" x:Name="ClientComboBox" 
                                  Height="25" Margin="0,5,0,5"
                                  DisplayMemberPath="FullName"
                                  SelectedValuePath="Id_Zakazchika"/>
                    </Grid>

                    <!-- Изделие -->
                    <Label Margin="0,15,0,5" Content="Изделие:" Foreground="White"/>
                    <TextBox x:Name="ProductBox" 
                             Height="60" Margin="0,0,0,15" 
                             TextWrapping="Wrap" AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"/>

                    <!-- Сообщения об ошибках -->
                    <Border x:Name="ErrorBorder" Background="#FFFDE8E8" BorderBrush="#FFE74C3C" 
                            BorderThickness="1" CornerRadius="3" Padding="10" Margin="0,20,0,0"
                            Visibility="Collapsed">
                        <TextBlock x:Name="ErrorText" Foreground="#FFC0392B" TextWrapping="Wrap"/>
                    </Border>

                    <!-- Кнопки формы -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,30,0,0">
                        <Button x:Name="SaveButton" Content="Сохранить" 
                                Width="120" Height="35" Margin="5,0" 
                                Background="#FF27AE60" Foreground="White"
                                FontWeight="Bold" Click="SaveButton_Click"/>
                        <Button x:Name="CancelButton" Content="Отмена" 
                                Width="120" Height="35" Margin="5,0" 
                                Background="#FFE74C3C" Foreground="White"
                                FontWeight="Bold" Click="CancelButton_Click"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Page>
